<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Aluno - FatecWeek 2025</title>
    <link rel="stylesheet" href="style-login.css">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <img src="https://i.imgur.com/WXNFN93.png" alt="Logo FatecWeek" class="logo-principal">
            <a href="index.html" class="btn-voltar">‚Üê Voltar</a>
        </div>
    </header>

    <main class="login-container">
        <div class="login-card">
            <div class="login-header aluno">
                <h1>üéì Login Aluno</h1>
                <p>Acesse com sua conta Google institucional</p>
            </div>

            <div class="login-content">
                <div id="loginStatus" class="status-message"></div>
                
                <!-- Etapa 1: Bot√£o Google -->
                <div id="etapaLogin">
                    <div id="buttonDiv"></div>
                </div>

                <!-- Etapa 2: Formul√°rio -->
                <div id="etapaCadastro" class="form-complemento">
                    <div class="user-card">
                        <h3 id="userName"></h3>
                        <p id="userEmail"></p>
                    </div>

                    <form id="formComplemento" onsubmit="finalizarCadastro(event)">
                        <div class="form-group">
                            <label for="ra">RA (Registro Acad√™mico) *</label>
                            <input type="text" id="ra" required 
                                   placeholder="Digite seu RA"
                                   pattern="[0-9]+" 
                                   maxlength="10"
                                   oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                            <small>Apenas n√∫meros. Exemplo: 123456</small>
                        </div>

                        <div class="form-group">
                            <label for="fatec">Sua FATEC *</label>
                            <select id="fatec" required>
                                <option value="">Selecione sua FATEC</option>
                                <option value="fatec-osasco">FATEC Osasco - Prefeito Hirant Sanazar</option>
                                <option value="fatec-sp">FATEC S√£o Paulo</option>
                                <option value="fatec-zona-leste">FATEC Zona Leste</option>
                                <option value="fatec-zona-sul">FATEC Zona Sul</option>
                                <option value="fatec-ipiranga">FATEC Ipiranga</option>
                                <option value="fatec-guarulhos">FATEC Guarulhos</option>
                                <option value="fatec-carapicuiba">FATEC Carapicu√≠ba</option>
                                <option value="fatec-tatuape">FATEC Tatuap√©</option>
                                <option value="outra">Outra FATEC</option>
                            </select>
                        </div>

                        <div class="form-group" id="outraFatecGroup" style="display: none;">
                            <label for="outraFatec">Qual FATEC?</label>
                            <input type="text" id="outraFatec" placeholder="Digite o nome da sua FATEC">
                        </div>

                        <button type="submit" class="btn-continue aluno">Finalizar e Acessar Sistema</button>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- Google Sign-In -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <script>
        // SUBSTITUA PELO SEU CLIENT ID DO GOOGLE
        const GOOGLE_CLIENT_ID = "SEU_CLIENT_ID_AQUI.apps.googleusercontent.com";
        
        let dadosUsuario = null;

        window.onload = function() {
            google.accounts.id.initialize({
                client_id: GOOGLE_CLIENT_ID,
                callback: handleCredentialResponse
            });

            google.accounts.id.renderButton(
                document.getElementById("buttonDiv"),
                { 
                    theme: "outline", 
                    size: "large",
                    width: 350,
                    text: "signin_with",
                    locale: "pt-BR"
                }
            );
        };

        function handleCredentialResponse(response) {
            const userObject = parseJwt(response.credential);
            
            // Validar email institucional
            if (!userObject.email.endsWith('@fatec.sp.gov.br')) {
                mostrarMensagem('‚ö†Ô∏è Use seu e-mail institucional (@fatec.sp.gov.br)', 'error');
                return;
            }

            dadosUsuario = userObject;
            mostrarFormulario();
        }

        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        function mostrarFormulario() {
            document.getElementById('etapaLogin').style.display = 'none';
            document.getElementById('etapaCadastro').style.display = 'block';
            
            document.getElementById('userName').textContent = dadosUsuario.name;
            document.getElementById('userEmail').textContent = dadosUsuario.email;
            
            mostrarMensagem('‚úÖ Login realizado! Complete seu cadastro.', 'success');
        }

        // Mostrar campo "Outra FATEC"
        document.addEventListener('DOMContentLoaded', function() {
            const selectFatec = document.getElementById('fatec');
            if (selectFatec) {
                selectFatec.addEventListener('change', function() {
                    const outraGroup = document.getElementById('outraFatecGroup');
                    const outraInput = document.getElementById('outraFatec');
                    
                    if (this.value === 'outra') {
                        outraGroup.style.display = 'block';
                        outraInput.required = true;
                    } else {
                        outraGroup.style.display = 'none';
                        outraInput.required = false;
                    }
                });
            }
        });

        function finalizarCadastro(event) {
            event.preventDefault();

            const alunoCompleto = {
                nome: dadosUsuario.name,
                email: dadosUsuario.email,
                foto: dadosUsuario.picture || '',
                ra: document.getElementById('ra').value,
                fatec: document.getElementById('fatec').value,
                outraFatec: document.getElementById('outraFatec').value,
                tipo: 'aluno',
                dataRegistro: new Date().toISOString()
            };

            localStorage.setItem('usuarioLogado', JSON.stringify(alunoCompleto));
            
            mostrarMensagem('‚úÖ Cadastro completo! Redirecionando...', 'success');
            
            setTimeout(() => {
                window.location.href = 'dashboard-aluno.html';
            }, 1500);
        }

        function mostrarMensagem(texto, tipo) {
            const msg = document.getElementById('loginStatus');
            msg.textContent = texto;
            msg.className = `status-message ${tipo}`;
            msg.style.display = 'block';
            
            if (tipo === 'success') {
                setTimeout(() => {
                    msg.style.display = 'none';
                }, 5000);
            }
        }
    </script>
</body>
</html>